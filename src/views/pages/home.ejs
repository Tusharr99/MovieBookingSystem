<%- include('../partials/header', { title, user }) %>
<section class="space-y-6">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <p class="text-sm uppercase tracking-wide text-emerald-300">Now showing</p>
      <h1 class="text-2xl font-semibold">Movies</h1>
      <p class="text-sm text-slate-400">Browse movies and search by title.</p>
    </div>
    <div class="w-full sm:w-72">
      <label class="sr-only" for="movieSearch">Search movies</label>
      <input
        id="movieSearch"
        type="search"
        placeholder="Search movies..."
        class="w-full rounded bg-slate-900 border border-slate-800 px-3 py-2 text-sm focus:border-emerald-400 focus:outline-none"
      />
    </div>
  </div>

  <div id="movieGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <% if (movies && movies.length) { %>
      <% movies.forEach(movie => { %>
        <a
          href="/movies/<%= movie._id %>"
          data-movie-card
          data-title="<%= (movie.title || '').toLowerCase() %>"
          data-desc="<%= (movie.description || '').toLowerCase() %>"
          class="group block bg-slate-900 border border-slate-800 rounded-lg overflow-hidden shadow-lg shadow-emerald-900/30 transition hover:border-emerald-500/60"
        >
          <% if (movie.posterUrl) { %>
            <img src="<%= movie.posterUrl %>" alt="<%= movie.title %>" class="h-56 w-full object-cover group-hover:opacity-95" />
          <% } %>
          <div class="p-4 space-y-2">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-semibold"><%= movie.title %></h2>
              <span class="px-2 py-1 rounded-full bg-emerald-900/50 text-emerald-300 text-xs">
                <%= movie.status === 'coming_soon' ? 'Coming Soon' : 'Now Showing' %>
              </span>
            </div>
            <p class="text-sm text-slate-300 line-clamp-3"><%= movie.description || 'No description yet.' %></p>
            <div class="flex items-center justify-between text-xs text-slate-400">
              <span><%= movie.durationMins ? movie.durationMins + ' mins' : 'TBD' %></span>
              <span class="text-emerald-300 font-semibold group-hover:text-emerald-200">Book tickets â†’</span>
            </div>
          </div>
        </a>
      <% }) %>
    <% } %>
  </div>
  <p id="movieEmpty" class="text-slate-300 <%= movies && movies.length ? 'hidden' : '' %>">
    No movies match your search. <% if (!movies || !movies.length) { %>Sign in as admin to add some.<% } %>
  </p>
</section>


<script>
  // Movie search filter
  const movieSearch = document.getElementById('movieSearch');
  const movieCards = Array.from(document.querySelectorAll('[data-movie-card]'));
  const movieEmpty = document.getElementById('movieEmpty');

  const filterMovies = () => {
    if (!movieSearch) return;
    const term = movieSearch.value.trim().toLowerCase();
    let visible = 0;
    movieCards.forEach((card) => {
      const hay = (card.dataset.title || '') + ' ' + (card.dataset.desc || '');
      const match = !term || hay.includes(term);
      card.classList.toggle('hidden', !match);
      if (match) visible += 1;
    });
    if (movieEmpty) {
      movieEmpty.classList.toggle('hidden', visible !== 0);
    }
  };
  if (movieSearch) {
    movieSearch.addEventListener('input', filterMovies);
    filterMovies();
  }
</script>
<%- include('../partials/footer') %>
